<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content='width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport' />

    <title>OPTO | Budget</title>

    <link rel="icon" href="favicon.png" sizes="64x64" type="image/png" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Reset CSS -->
    <link rel="stylesheet" href="css/reset.css" />

    <!-- Font CSS -->
    <link rel="stylesheet" href="fonts/mulish/style.css" />
    <link rel="stylesheet" href="fonts/inter/style.css" />

    <!-- Datepicker CSS -->
    <link rel="stylesheet" href="datepicker/css/datepicker.min.css" />

    <!-- Grid CSS -->
    <link href="css/grid.css" rel="stylesheet" media="screen" />

    <!-- Custom CSS -->
    <link href="css/custom.css" rel="stylesheet" media="screen" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
</head>

<header class="header">
  <div class="header-container">
    <a href="/home" class="logo"></a>
    <%= render "shared/navbar" %>
  </div>
</header>

<body class="left-menu-hide">

    <section class="content">
        <div class="content-container">

            <div class="row mb-30">
                <div class="col-xs-12 col-md-9 col-lg-9">
                    <p class="mt-10">To start creating your budget for the rest of this quarter, click on the sections below. Add your personal budget items to the "Non-School Budget Items" section, and select from pre-populated list of school fees and other expenses in the other two budget sections. Then, when you've added a few expenses, click "Load Chart" to see them reflected there.</p>
                </div>
                
                <div class="text-right mt-10 col-xs-12 col-md-3 col-lg-3">
                  <a class="btn btn-primary modal-open" data-modal="getStartedInstructions">Other Tips</a>
                </div>

              </div>
            </div>

            <div class="row">
                <div class="col-xs-12 col-md-12 col-lg-7">
                    <div class="well well-xs mb-20">

                        <div class="accordion-total">
                            <h3 class="accordion-total-title">Total Budget<span>$<%= number_with_delimiter(BudgetExpense.where({user_id: @current_user.id}).where.not(expense_amount: nil).sum(:expense_amount).truncate, :delimiter => ',') %></span></h3>
                        </div>

                        <div class="accordion">
                            <h3 class="accordion-title">
                                <span class="accordion-icon"></span>
                                Non-School Budget Items
                                <span class="accordion-no">$<%= number_with_delimiter(BudgetExpense.where({user_id: @current_user.id}).where.not({expense_category_id: "38"}).where.not({expense_category_id: "43"}).where.not(expense_amount: nil).sum(:expense_amount).truncate, :delimiter => ',') %></span>
                            </h3>

                            <div class="accordion-content">
                                <!-- Sub Child 1-->
                               
                                        <div class="accordion accordion-nested">
                                            <h4 class="accordion-title">
                                                <span class="accordion-icon"></span>
                                                <div class="row">
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Expense</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <p class="hide-xs">Category</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Freq.</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Est. Date</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Amount</p>
                                                    </div>
                                                    <!--<div class="col-xs-12 col-sm-3 text-right">
                                                        <p>$9,500</p>
                                                    </div>-->
                                                </div>
                                            </h4>
                                            <div class="accordion-content">
                                                <h4 class="accordion-content-table">

                                                    <% 
                                                    general_budget_expenses = BudgetExpense.where({user_id: @current_user.id})

                                                    @list_of_gen_expenses = general_budget_expenses.order({ :first_recurrence_date => :asc })

                                                    for a_budget_expense in @list_of_gen_expenses.where.not({expense_category_id: "38"}).where.not({expense_category_id: "43"}).where.not(expense_amount: nil) do %>

                                                    <div class="row">

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span><%= a_budget_expense.expense_name %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-3">
                                                          <p><span class="show-xs font700"></span><%= @category_reference = TransactionCategory.where({id: a_budget_expense.expense_category_id}).first
                                                          @category_reference.spend_category_name %></p>
                                                      </div>                                      

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span>
                                                          <%= if a_budget_expense.recurring_frequency == 1
                                                            "One-Time"
                                                          elsif a_budget_expense.recurring_frequency == 52
                                                            "Weekly"
                                                          elsif a_budget_expense.recurring_frequency == 26
                                                            "Biweekly"
                                                          elsif a_budget_expense.recurring_frequency == 12
                                                            "Monthly"
                                                          elsif a_budget_expense.recurring_frequency == 4
                                                            "Quarterly"
                                                          end %>
                                                          </p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span><%= a_budget_expense.first_recurrence_date.strftime("%b. %d") %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span>$<%= number_with_delimiter(a_budget_expense.expense_amount.truncate, :delimiter => ',')
                                                           %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-1 col-actions">
                                                            <a href="/budget_expenses/<%= a_budget_expense.id %>" class="accordion-btn-edit"></a>
                                                      </div>
                                                      
                                                    </div>

                                                    <% end %>


                                                      <div class="row">

                                                      <form action="/insert_budget_expense" method="post">
                                                            
                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="expense_name_box" name="query_expense_name" size="5" placeholder="Item" required="True"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <select id="expense_category_id_box"name="query_expense_category_id" required="True" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value=1>Auto & Transportation</option>
                                                              <option value=2>Bills & Utilities</option>
                                                              <option value=3>Debt Payments</option>
                                                              <option value=4>Dining & Drinking</option>
                                                              <option value=5>Education</option>
                                                              <option value=6>Entertainment</option>
                                                              <option value=7>Fitness & Personal Care</option>
                                                              <option value=8>Gifts & Donations</option>
                                                              <option value=9>Government</option>
                                                              <option value=10>Groceries</option>
                                                              <option value=11>Health & Insurance</option>
                                                              <option value=12>Home</option>
                                                              <option value=13>Pets</option>
                                                              <option value=14>Rent & Mortgage</option>
                                                              <option value=15>Services</option>
                                                              <option value=16>Shopping</option>
                                                              <option value=17>Travel</option>
                                                              <option value=18>Other</option>
                                                            </select></p>
                                                            </div>


                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1">
                                                            
                                                            <select id="recurring_frequency_box"name="query_recurring_frequency" required="True" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value="1">One-Time</option>
                                                              <option value="52">Weekly</option>
                                                              <option value="26">Biweekly</option>
                                                              <option value="12">Monthly</option>
                                                              <option value="4">Quarterly</option>
                                                            </select>
                                                            </div>

                                                            
                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1"">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="date" id="first_recurrence_date_box" name="query_first_recurrence_date" required="True" style="width: 80px"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="expense_amount_box" required="True" name="query_expense_amount" size="5" placeholder="$"></p>
                                                            </div>

                                                          
                                                            <input type="hidden" name="query_user_id" value="<%= @current_user.id %>">
                                                          
                                                          <div class="col-xs-6 col-sm-6 col-sm-offset-8 col-md-6 col-lg-6 col-xl-4 md-10">
                                                          <input type="submit" value="Add new expense" class="btn btn-secondary btn-sm" />
                                                          </div>

                                                        </form>

                                                        </div>
                                                    

                                                </h4>

                                            </div>
                                        </div>
                                 



                            </div>
                        </div>

                        <!-- Second full accordion grouping starts below-->

                        <div class="accordion">
                            <h3 class="accordion-title">
                                <span class="accordion-icon"></span>
                                Required School Fees
                                <span class="accordion-no">$<%= number_with_delimiter(BudgetExpense.where({user_id: @current_user.id}).where({expense_category_id: "38"}).where.not(expense_amount: nil).sum(:expense_amount).truncate, :delimiter => ',') %></span>
                            </h3>

                            <div class="accordion-content">
                                <!-- Sub Child 1-->
                               
                                        <div class="accordion accordion-nested">
                                            <h4 class="accordion-title">
                                                <span class="accordion-icon"></span>
                                                <div class="row">
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Expense</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <p class="hide-xs">Category</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Freq.</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Est. Date</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Amount</p>
                                                    </div>
                                                    <!--<div class="col-xs-12 col-sm-3 text-right">
                                                        <p>$9,500</p>
                                                    </div>-->
                                                </div>
                                            </h4>
                                            <div class="accordion-content">
                                                <h4 class="accordion-content-table">
                                                    
                                                    <%
                                                    budget_school_fees = BudgetExpense.where({user_id: @current_user.id})

                                                    @list_of_school_fees = budget_school_fees.order({ :first_recurrence_date => :asc })

                                                    for a_budget_expense in @list_of_school_fees.where({expense_category_id: "38"}).where.not(expense_amount: nil) do %>

                                                    <div class="row">

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span><%= a_budget_expense.expense_name %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-3">
                                                          <p><span class="show-xs font700"></span><%= @category_reference = TransactionCategory.where({id: a_budget_expense.expense_category_id}).first
                                                          @category_reference.spend_category_name %></p>
                                                      </div>                                      

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span>
                                                          <%= if a_budget_expense.recurring_frequency == 1
                                                            "One-Time"
                                                          elsif a_budget_expense.recurring_frequency == 52
                                                            "Weekly"
                                                          elsif a_budget_expense.recurring_frequency == 26
                                                            "Biweekly"
                                                          elsif a_budget_expense.recurring_frequency == 12
                                                            "Monthly"
                                                          elsif a_budget_expense.recurring_frequency == 4
                                                            "Quarterly"
                                                          end %>
                                                          </p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span><%= a_budget_expense.first_recurrence_date.strftime("%b. %d") %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span>$<%= number_with_delimiter(a_budget_expense.expense_amount.truncate, :delimiter => ',')
                                                           %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-1 col-actions">
                                                            <a href="/budget_expenses/<%= a_budget_expense.id %>" class="accordion-btn-edit"></a>
                                                      </div>
                                                      
                                                      
                                                    </div>

                                                    <% end %>

                                                    

                                                      <div class="row">

                                                      <form action="/insert_budget_expense" method="post">
                                                            
                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="expense_name_box" name="query_expense_name" size="5" placeholder="Item" required="True"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <select id="expense_category_id_box"name="query_expense_category_id" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value=38>Auto & Transportation</option>
                                                              <option value=38>Bills & Utilities</option>
                                                              <option value=38>Debt Payments</option>
                                                              <option value=38>Dining & Drinking</option>
                                                              <option value=38>Education</option>
                                                              <option value=38>Entertainment</option>
                                                              <option value=38>Fitness & Personal Care</option>
                                                              <option value=38>Gifts & Donations</option>
                                                              <option value=38>Government</option>
                                                              <option value=38>Groceries</option>
                                                              <option value=38>Health & Insurance</option>
                                                              <option value=38>Home</option>
                                                              <option value=38>Pets</option>
                                                              <option value=38>Rent & Mortgage</option>
                                                              <option value=38>Services</option>
                                                              <option value=38>Shopping</option>
                                                              <option value=38>Travel</option>
                                                              <option value=38>Other</option>
                                                            </select></p>
                                                            </div>


                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1">
                                                            
                                                            <select id="recurring_frequency_box"name="query_recurring_frequency" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value="1">One-Time</option>
                                                              <option value="52">Weekly</option>
                                                              <option value="26">Biweekly</option>
                                                              <option value="12">Monthly</option>
                                                              <option value="4">Quarterly</option>
                                                            </select>
                                                            </div>

                                                            
                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1"">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="date" id="first_recurrence_date_box" name="query_first_recurrence_date" required="True" style="width: 80px"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="expense_amount_box" name="query_expense_amount" required="True" size="5" placeholder="$"></p>
                                                            </div>

                                                          
                                                            <input type="hidden" name="query_user_id" value="<%= @current_user.id %>">
                                                          
                                                          <div class="col-xs-6 col-sm-6 col-sm-offset-8 col-md-6 col-lg-6 col-xl-4 md-10">
                                                          <input type="submit" value="Add Custom Fee" class="btn btn-secondary btn-sm" />
                                                          </div>

                                                        </form>

                                                        </div>
                                                    

                                                </h4>

                                                <div class="text-right mt-20">
                                                    <a class="btn btn-primary btn-sm modal-open" data-modal="requiredSchoolFees">Add From Prepared List</a>
                                                </div>
 
                                            </div>
                                        </div>
                                 



                            </div>
                        </div>

                        <!-- Third full accordion grouping starts below-->

                        <div class="accordion">
                            <h3 class="accordion-title">
                                <span class="accordion-icon"></span>
                                Optional School Expenses
                                <span class="accordion-no">$<%= number_with_delimiter(BudgetExpense.where({user_id: @current_user.id}).where({expense_category_id: "43"}).where.not(expense_amount: nil).sum(:expense_amount).truncate, :delimiter => ',') %></span>
                            </h3>

                            <div class="accordion-content">
                                <!-- Sub Child 1-->
                               
                                        <div class="accordion accordion-nested">
                                            <h4 class="accordion-title">
                                                <span class="accordion-icon"></span>
                                                <div class="row">
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Expense</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <p class="hide-xs">Category</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Freq.</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Est. Date</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Amount</p>
                                                    </div>
                                                    <!--<div class="col-xs-12 col-sm-3 text-right">
                                                        <p>$9,500</p>
                                                    </div>-->
                                                </div>
                                            </h4>
                                            <div class="accordion-content">
                                                <h4 class="accordion-content-table">
                                                    
                                                    <%
                                                    budget_school_events = BudgetExpense.where({user_id: @current_user.id})

                                                    @list_of_school_events = budget_school_events.order({ :first_recurrence_date => :asc })

                                                    for a_budget_expense in @list_of_school_events.where({expense_category_id: "43"}).where.not(expense_amount: nil) do %>

                                                    <div class="row">

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span><%= a_budget_expense.expense_name %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-3">
                                                          <p><span class="show-xs font700"></span><%= @category_reference = TransactionCategory.where({id: a_budget_expense.expense_category_id}).first
                                                          @category_reference.spend_category_name %></p>
                                                      </div>                                      

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span>
                                                          <%= if a_budget_expense.recurring_frequency == 1
                                                            "One-Time"
                                                          elsif a_budget_expense.recurring_frequency == 52
                                                            "Weekly"
                                                          elsif a_budget_expense.recurring_frequency == 26
                                                            "Biweekly"
                                                          elsif a_budget_expense.recurring_frequency == 12
                                                            "Monthly"
                                                          elsif a_budget_expense.recurring_frequency == 4
                                                            "Quarterly"
                                                          end %>
                                                          </p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span><%= a_budget_expense.first_recurrence_date.strftime("%b. %d") %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span>$<%= number_with_delimiter(a_budget_expense.expense_amount.truncate, :delimiter => ',')
                                                           %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-1 col-actions">
                                                            <a href="/budget_expenses/<%= a_budget_expense.id %>" class="accordion-btn-edit"></a>
                                                      </div>
                                                      
                                                      
                                                    </div>

                                                    <% end %>

                                                    

                                                      <div class="row">

                                                      <form action="/insert_budget_expense" method="post">
                                                            
                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="expense_name_box" name="query_expense_name" size="5" placeholder="Item" required="True"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <select id="expense_category_id_box"name="query_expense_category_id" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value=43>Auto & Transportation</option>
                                                              <option value=43>Bills & Utilities</option>
                                                              <option value=43>Debt Payments</option>
                                                              <option value=43>Dining & Drinking</option>
                                                              <option value=43>Education</option>
                                                              <option value=43>Entertainment</option>
                                                              <option value=43>Fitness & Personal Care</option>
                                                              <option value=43>Gifts & Donations</option>
                                                              <option value=43>Government</option>
                                                              <option value=43>Groceries</option>
                                                              <option value=43>Health & Insurance</option>
                                                              <option value=43>Home</option>
                                                              <option value=43>Pets</option>
                                                              <option value=43>Rent & Mortgage</option>
                                                              <option value=43>Services</option>
                                                              <option value=43>Shopping</option>
                                                              <option value=43>Travel</option>
                                                              <option value=43>Other</option>
                                                            </select></p>
                                                            </div>


                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1">
                                                            
                                                            <select id="recurring_frequency_box"name="query_recurring_frequency" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value="1">One-Time</option>
                                                              <option value="52">Weekly</option>
                                                              <option value="26">Biweekly</option>
                                                              <option value="12">Monthly</option>
                                                              <option value="4">Quarterly</option>
                                                            </select>
                                                            </div>

                                                            
                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1"">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="date" id="first_recurrence_date_box" name="query_first_recurrence_date" required="True" style="width: 80px"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="expense_amount_box" name="query_expense_amount" required="True" size="5" placeholder="$"></p>
                                                            </div>

                                                          
                                                            <input type="hidden" name="query_user_id" value="<%= @current_user.id %>">
                                                          
                                                          <div class="col-xs-6 col-sm-6 col-sm-offset-8 col-md-6 col-lg-6 col-xl-4 md-10">
                                                          <input type="submit" value="Add Custom Item" class="btn btn-secondary btn-sm" />
                                                          </div>

                                                        </form>

                                                        </div>
                                                    

                                                </h4>

                                                <div class="text-right mt-20">
                                                    <a class="btn btn-primary btn-sm modal-open" data-modal="optionalSchoolEvents">Add From Prepared List</a>
                                                </div>

                                            </div>
                                        </div>
                                 



                            </div>
                        </div>


                    </div>
                </div>



<!--The chart starts below-->

                <div class="col-xs-12 col-md-12 col-lg-5">
                    <div class="well well-sm mb-20">
                        <row>
                        <h2 class="font700 text-upper col-xs-12 col-md-5 col-lg-5">Total Budget</h2>
                        <div class="text-left mt-10 col-xs-12 col-md-6 col-lg-6 col-md-offset-1 col-lg-offset-1">
                          <% matching_user_budgets = UserBudget.where({user_id: @current_user.id})
                          @list_of_user_budgets = matching_user_budgets.order({ :created_at => :asc })%>

                          <a class="btn btn-primary" onclick="updateConfigByMutating(totalBudgetChart,<%= @list_of_user_budgets.all.map {|p| p.first_day_of_month.strftime('%b')}.first(7) %>,<%= @list_of_user_budgets.all.map {|p| p.total_expenses}.first(7)%>)">Load Chart</a>
                        </div>
                        </row>
                        <canvas id="totalBudgetChart"></canvas>
                        
                    </div>
                </div>
            </div>
            <!-- ./row-->


<!--The Income table is below-->

            <div class="row">
                <div class="col-xs-12 col-md-12 col-lg-7">
                    <div class="well well-xs mb-20">

                        <div class="accordion-total">
                            <h3 class="accordion-total-title">Income<span>$<%= number_with_delimiter(BudgetIncome.where({user_id: @current_user.id}).where.not(income_amount: nil).sum(:income_amount).truncate, :delimiter => ',') %></span></h3>
                        </div>

                        <div class="accordion">
                            <h3 class="accordion-title">
                                <span class="accordion-icon"></span>
                                All Income
                                <span class="accordion-no">$<%= number_with_delimiter(BudgetIncome.where({user_id: @current_user.id}).where.not(income_amount: nil).sum(:income_amount).truncate, :delimiter => ',') %></span>
                            </h3>

                            <div class="accordion-content">
                                <!-- Sub Child 1-->
                               
                                        <div class="accordion accordion-nested">
                                            <h4 class="accordion-title">
                                                <span class="accordion-icon"></span>
                                                <div class="row">
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Item</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-3">
                                                        <p class="hide-xs">Category</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Freq.</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Est. Date</p>
                                                    </div>
                                                    <div class="col-xs-12 col-sm-2">
                                                        <p class="hide-xs">Amount</p>
                                                    </div>
                                                    <!--<div class="col-xs-12 col-sm-3 text-right">
                                                        <p>$9,500</p>
                                                    </div>-->
                                                </div>
                                            </h4>
                                            <div class="accordion-content">
                                                <h4 class="accordion-content-table">

                                                  <% 
                                                  budget_income_items = BudgetIncome.where({user_id: @current_user.id})

                                                  @list_of_income_items = budget_income_items.order({ :first_recurrence_date => :asc })

                                                  for a_budget_income in @list_of_income_items.where.not(income_amount: nil) do %>
                                                    
                                                    <div class="row">

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span><%= a_budget_income.income_name %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-3">
                                                          <p><span class="show-xs font700"></span><%= @category_reference = TransactionCategory.where({id: a_budget_income.income_category_id}).first
                                                          @category_reference.spend_sub_category %></p>
                                                      </div>                                      

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span>
                                                          <%= if a_budget_income.recurring_frequency == 1
                                                            "One-Time"
                                                          elsif a_budget_income.recurring_frequency == 52
                                                            "Weekly"
                                                          elsif a_budget_income.recurring_frequency == 26
                                                            "Biweekly"
                                                          elsif a_budget_income.recurring_frequency == 12
                                                            "Monthly"
                                                          elsif a_budget_income.recurring_frequency == 4
                                                            "Quarterly"
                                                          end %>
                                                          </p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span><%= a_budget_income.first_recurrence_date.strftime("%b. %d") %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-2">
                                                          <p><span class="show-xs font700"></span>$<%= number_with_delimiter(a_budget_income.income_amount.truncate, :delimiter => ',')
                                                           %></p>
                                                      </div>

                                                      <div class="col-xs-12 col-sm-1 col-actions">
                                                            <a href="/budget_incomes/<%= a_budget_income.id %>" class="accordion-btn-edit"></a>
                                                        </div>
                                                      
                                                    </div>

                                                    <% end %>

                                                      <div class="row">

                                                      <form action="/insert_budget_income" method="post">
                                                            
                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="income_name_box" name="query_income_name" size="5" placeholder="Item" required="True"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <select id="income_category_id_box" name="query_income_category_id" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value=86>Wages</option>
                                                              <option value=87>Other</option>
                                                              <option value=82>Interest & Dividends</option>
                                                              <option value=83>Retirement & Pension</option>
                                                              <option value=84>Tax Refund</option>
                                                              <option value=85>Unemployment</option>
                                                            </select></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1">                                               
                                                            <select id="recurring_frequency_box"name="query_recurring_frequency" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value="1">One-Time</option>
                                                              <option value="52">Weekly</option>
                                                              <option value="26">Biweekly</option>
                                                              <option value="12">Monthly</option>
                                                              <option value="4">Quarterly</option>
                                                            </select>
                                                            </div>
                                                            
                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1"">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="date" id="first_recurrence_date_box" required="True" name="query_first_recurrence_date" style="width: 80px"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="income_amount_box" name="query_income_amount" required="True" size="5" placeholder="$"></p>
                                                            </div>

                                                            <input type="hidden" name="query_user_id" value="<%= @current_user.id %>">
                                                          
                                                          <div class="col-xs-6 col-sm-6 col-sm-offset-8 col-md-6 col-lg-6 col-xl-4 md-10">
                                                          <input type="submit" value="Add New Income" class="btn btn-secondary btn-sm" />
                                                          </div>

                                                        </form>

                                                        </div>
                                                    
                                                </h4>
                                            </div>
                                        </div>

                            </div>
                            <!--End of Sub Child 1-->

                        </div>
                        <!--End of Accordion-->



                <!--New Test
                    <div class="accordion">
                            <h3 class="accordion-title">
                                <span class="accordion-icon"></span>
                                All Income
                                <span class="accordion-no">$<%= number_with_delimiter(BudgetIncome.where({user_id: @current_user.id}).where.not(income_amount: nil).sum(:income_amount).truncate, :delimiter => ',') %></span>
                            </h3>

                            <div class="accordion-content">
                               
                                <div class="table-scroll">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th class="text-left">Item</th>
                                                <th class="text-right">Category</th>
                                                <th class="text-right">Freq.</th>
                                                <th class="text-right">Est. Date</th>
                                                <th class="text-right">Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>

                                            <% 
                                            budget_income_items = BudgetIncome.where({user_id: @current_user.id})

                                            @list_of_income_items = budget_income_items.order({ :first_recurrence_date => :asc })

                                            for a_budget_income in @list_of_income_items.where.not(income_amount: nil) do %>
                                    
                                                <tr>
                                                <td><span class="show-xs font700"></span><%= a_budget_income.income_name %></td>
                                                <td class="text-right"><span class="show-xs font700"></span><%= @category_reference = TransactionCategory.where({id: a_budget_income.income_category_id}).first
                                                          @category_reference.spend_sub_category %></td>

                                                <td class="text-right"><span class="show-xs font700"><span class="show-xs font700"></span>
                                                          <%= if a_budget_income.recurring_frequency == 1
                                                            "One-Time"
                                                          elsif a_budget_income.recurring_frequency == 52
                                                            "Weekly"
                                                          elsif a_budget_income.recurring_frequency == 26
                                                            "Biweekly"
                                                          elsif a_budget_income.recurring_frequency == 12
                                                            "Monthly"
                                                          elsif a_budget_income.recurring_frequency == 4
                                                            "Quarterly"
                                                          end %></td>

                                                <td class="text-right"><span class="show-xs font700"></span><%= a_budget_income.first_recurrence_date.strftime("%b. %d") %></td> 
                                                </tr>
                                                <td class="text-right"><span class="show-xs font700"></span>$<%= number_with_delimiter(a_budget_income.income_amount.truncate, :delimiter => ',')
                                                           %></td> 
                                                </tr>
                                                <td class="text-right"><a href="/budget_incomes/<%= a_budget_income.id %>" class="accordion-btn-edit"></a></td> 
                                                </tr>

                                            <%end%>

                                            

                                        </tbody>

                                        <div class="row">

                                              <form action="/insert_budget_income" method="post">
                                                            
                                              <div class="col-xs-12 col-sm-2">
                                              <p><span class="show-xs font700"></span>
                                              <input type="text" id="income_name_box" name="query_income_name" size="5" placeholder="Item" required="True"></p>
                                              </div>

                                              <div class="col-xs-12 col-sm-2">
                                              <p><span class="show-xs font700"></span>
                                              <select id="income_category_id_box" name="query_income_category_id" style="width: 90px">
                                              <option value="Select One">Select One</option>
                                              <option value=86>Wages</option>
                                              <option value=87>Other</option>
                                              <option value=82>Interest & Dividends</option>
                                              <option value=83>Retirement & Pension</option>
                                              <option value=84>Tax Refund</option>
                                              <option value=85>Unemployment</option>
                                              </select></p>
                                              </div>

                                              <div class="col-xs-12 col-sm-2 col-sm-offset-1">                                               
                                              <select id="recurring_frequency_box"name="query_recurring_frequency" style="width: 90px">
                                                              <option value="Select One">Select One</option>
                                                              <option value="1">One-Time</option>
                                                              <option value="52">Weekly</option>
                                                              <option value="26">Biweekly</option>
                                                              <option value="12">Monthly</option>
                                                              <option value="4">Quarterly</option>
                                                            </select>
                                                            </div>
                                                            
                                                            <div class="col-xs-12 col-sm-2 col-sm-offset-1"">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="date" id="first_recurrence_date_box" required="True" name="query_first_recurrence_date" style="width: 80px"></p>
                                                            </div>

                                                            <div class="col-xs-12 col-sm-2">
                                                            <p><span class="show-xs font700"></span>
                                                            <input type="text" id="income_amount_box" name="query_income_amount" required="True" size="5" placeholder="$"></p>
                                                            </div>

                                                            <input type="hidden" name="query_user_id" value="<%= @current_user.id %>">
                                                          
                                                          <div class="col-xs-6 col-sm-6 col-sm-offset-8 col-md-6 col-lg-6 col-xl-4 md-10">
                                                          <input type="submit" value="Add New Income" class="btn btn-secondary btn-sm" />
                                                          </div>

                                                        </form>

                                                        </div>
                                    </table>
                                </div>

                                      

                                                      
                                                    
                                          
                              </div>

                            </div>
                            End of Sub Child 1

                        </div>
                        End of Accordion-->


                    </div>
                    <!--End of Well-->
                
                </div>
                <!--End of Left Content Block-->


            </div>
                <!-- ./row-->


          <div row>

            <div class="col-xs-12 col-md-12 col-lg-12 mb-20">
                            <div class="well">
                                <h2 class="font700">Monthly Budget Table</h2>
                               
                               <div class="table-scroll">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th class="text-left">Budget Month</th>
                                                <th class="text-right">Total Expenses</th>
                                                <th class="text-right">Total Income</th>
                                                <th class="text-right">Net Cash Flow</th>
                                            </tr>
                                        </thead>

                                        <tbody>

                                            <% 
                                            matching_user_budgets = UserBudget.where({user_id: @current_user.id})

                                            @list_of_user_budgets = matching_user_budgets.order({ :first_day_of_month => :asc })

                                            for a_user_budget in @list_of_user_budgets.where.not(total_expenses: nil) do %>
                                    
                                                <tr>
                                                <td class="text-left"><%= a_user_budget.first_day_of_month.strftime("%B %Y") %></td>
                                                <td class="text-right"><span class="color-blue font700">$<%= number_with_delimiter(a_user_budget.total_expenses.truncate, :delimiter => ',') %></span></td>
                                                <td class="text-right"><span class="color-blue font700">$<%= number_with_delimiter(a_user_budget.total_income.truncate, :delimiter => ',') %></span></td>
                                                <td class="text-right"><span class="color-blue font700">$<%= number_with_delimiter((a_user_budget.total_income - a_user_budget.total_expenses).truncate, :delimiter => ',') %></span></td>
                                                </tr>

                                            <%end%>

                                        </tbody>
                                    </table>
                                </div>

                                <!-- ./row-->


                            </div>
                        </div>
            </div>
            <!-- end row-->


            <div class="row mb-30">
                        <div class="col-xs-12 col-md-12 col-lg-12">
                            <a href="/cash_flows" class="btn btn-primary btn-block">View My Cash Flow</a>
                        </div>
                </div>






        </div>
    </section>
    <!-- ./content-->


<!-- The first pop out modal starts here-->

    <div class="modal" id="requiredSchoolFees">
        <div class="modal-content">
            <h2 class="font700">Required School Fees</h2>

            <div class="table-scroll">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="text-left">Expense</th>
                            <th class="text-right">Term</th>
                            <th class="text-right">Year</th>
                            <th class="text-right">Est. Date</th>
                            <th class="text-right">Amount</th>
                            <th class="text-right">Add to my Budget</th>
                        </tr>
                    </thead>

                    <tbody>

                      <% 
                      budget_school_fees_modal = SchoolFee.where({school: @current_user.school})

                      @list_of_school_fees_modal = budget_school_fees_modal.order({ :first_fee_date => :asc })

                      for a_school_fee in @list_of_school_fees_modal do %>

                        <tr>
                            <!--<td>
                                <label class="checkbox">
                                    <input type="checkbox" />
                                    <span class="checkmark"></span>
                                </label>
                                <span class="font700 color-grey">Pre-Orientation Trip:</span>
                            </td>-->
                            <td class="text-left"><%= a_school_fee.fee_name %></td>
                            <td class="text-left"><%= a_school_fee.term %></td>
                            <td class="text-left"><%= a_school_fee.year %></td>
                            <td class="text-right"><%= a_school_fee.first_fee_date.strftime("%b. %d") %></td>
                            <td class="text-right"><span class="color-blue font700">$<%= number_with_delimiter(a_school_fee.fee_amount.truncate, :delimiter => ',') %></span></td>

                            <td class="text-right">

                              <form action="/insert_budget_expense" method="post">

                                  <div>
                                    <input type="hidden" name="query_expense_name" value= "<%= a_school_fee.fee_name %>">  
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_expense_amount" value= "<%= a_school_fee.fee_amount %>">
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_expense_category_id" value="38">  
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_recurring_frequency" value="1">  
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_user_id" value="<%= @current_user.id %>">  
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_first_recurrence_date" value="<%= a_school_fee.first_fee_date %>">
                                  </div>

                                  <div class="text-right mt-20">
                                    <input type="submit" class="btn btn-primary btn-sm" value="Add" />
                                  </div>
                              </form>
                            </td>
  
                        </tr>

                      <% end %>

                    </tbody>
                </table>
            </div>


        </div>
    </div>
    <!-- ./modal-->


<!-- The second pop out modal starts here-->

    <div class="modal" id="optionalSchoolEvents">
        <div class="modal-content">
            <h2 class="font700">Optional School Events</h2>

            <div class="table-scroll">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="text-left">Event</th>
                            <th class="text-right">Host</th>
                            <th class="text-right">Start Date</th>
                            <th class="text-right">End Date</th>
                            <th class="text-right">Amount</th>
                            <th class="text-right">Add to my Budget</th>
                        </tr>
                    </thead>

                    <tbody>

                      <%
                      budget_school_events_modal = SchoolEvent.where({school: @current_user.school})

                      @list_of_school_events_modal = budget_school_events_modal.order({ :event_start_date => :asc })

                      for a_school_event in @list_of_school_events_modal do %>

                        <tr>
                            <!--<td>
                                <label class="checkbox">
                                    <input type="checkbox" />
                                    <span class="checkmark"></span>
                                </label>
                                <span class="font700 color-grey">Pre-Orientation Trip:</span>
                            </td>-->
                            <td class="text-left"><%= a_school_event.event_name %></td>
                            <td class="text-left"><%= a_school_event.host %></td>
                            <td class="text-right"><%= a_school_event.event_start_date.strftime("%b. %d") %></td>
                            <td class="text-right"><%= a_school_event.event_end_date.strftime("%b. %d") %></td>
                            <td class="text-right"><span class="color-blue font700">$<%= number_with_delimiter(a_school_event.estimated_cost.truncate, :delimiter => ',')%></span></td>

                            <td class="text-right">

                              <form action="/insert_budget_expense" method="post">

                                  <div>
                                    <input type="hidden" name="query_expense_name" value= "<%= a_school_event.event_name %>">  
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_expense_amount" value= "<%= a_school_event.estimated_cost %>">
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_expense_category_id" value="43">  
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_recurring_frequency" value="1">  
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_user_id" value="<%= @current_user.id %>">  
                                  </div>
                                  <div>
                                    <input type="hidden" name="query_first_recurrence_date" value="<%= a_school_event.event_start_date %>">
                                  </div>
                             
                                  <div class="text-right mt-20">
                                    <input type="submit" class="btn btn-primary btn-sm" value="Add" />
                                  </div>
                              </form>
                            </td>
  
                        </tr>

                      <% end %>

                    </tbody>
                </table>
            </div>


        </div>
    </div>
    <!-- ./modal-->


<!-- The third (instruction) pop out modal starts here-->

    <div class="modal" id="getStartedInstructions">
        <div class="modal-content">
            <h2 class="font700">Instructions for Getting Started</h2>

            <ul style="list-style-type:disc">
              <li>Click into the sections of your budget that you want to update.</li>
              <li>You can click the Add New button to select costs for your school that are already in our database.</li>
              <li>You can create your own events and categories by entering data directly into the blank row within each section.</li>
              <li>To update an existing entry, click on the pencil icon in the row of the expense you wish to change.</li>
              <li>To make sure your cash flow predictions are as accurate as possible, please be sure youre including all major sources of income and expenses. Note that loan disbursements should be considered income.</li>
              <li>As you adjust your budget, changes will be reflected in the chart on the right in real-time.</li>
            </ul>

            <br>
            <hr>

            <h3 class="font700">Extra Tips</h3>

            <ul style="list-style-type:disc">
              <li>If you arent certain of the exact date, default to the 1st of the month. From a cash flow perspective, its better to anticipate having to pay it earlier and then realizing you have some additional time rather than being surprised that the due date was sooner than you expected.</li>
              <li>Try to think about all of the costs associated with a specific event or category. For example, if you are adding the cost of a trip, consider adding a separate line item for flight costs and another line item for money you expect to spend when you're on the trip itself. You can always update this later but its better to be prepared! </li>
            </ul>


        </div>
    </div>
    <!-- ./modal-->




    <!-- jQuery -->
    <script src="js/jquery-1.11.1.min.js"></script>

    <!-- Datepicker JS -->
    <script src="datepicker/js/datepicker.min.js"></script>
    <script src="datepicker/js/i18n/datepicker.en.js"></script>

    <!-- Chart JS -->
    <script src="chart/chart.min.js"></script>
    <script src="chart/chart-init.js"></script>

    <!-- Custom Script  -->
    <script src="js/main.js"></script>

</body>

<script>'undefined'=== typeof _trfq || (window._trfq = []);'undefined'=== typeof _trfd && (window._trfd=[]),_trfd.push({'tccl.baseHost':'secureserver.net'},{'ap':'cpsh'},{'server':'a2plcpnl0893'},{'dcenter':'a2'},{'id':'5978661'}) // Monitoring performance to make your website faster. If you want to opt-out, please contact web hosting support.</script><script src='https://img1.wsimg.com/traffic-assets/js/tccl.min.js'></script><script src='https://img1.wsimg.com/traffic-assets/js/tccl-tti.min.js' onload='window.tti.calculateTTI()'></script></html>
